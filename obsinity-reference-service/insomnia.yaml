type: collection.insomnia.rest/5.0
name: Obsinity API Collection
meta:
  id: wrk_68f2907246df440f96e2f024b4a89fee
  created: 1754511487081
  modified: 1754511487081
  description: "Obsinity reference service (HTTP only) using EventEnvelope"

collection:
  # ================ Ingest (single) ================
  - url: "{{ base_url }}/api/ingest/event"
    name: Ingest EventEnvelope (single, OK)
    meta:
      id: req_ingest_single
      created: 1754511487081
      modified: 1754511487081
      isPrivate: false
      description: "Send a single EventEnvelope matching TelemetryHolder wire shape."
      sortKey: -100
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "eventId": "{{ event_id }}",
          "name": "api_request",
          "timestamp": "{{ nowIso }}",
          "endTimestamp": "{{ nowIso }}",
          "traceId": "{{ trace_id }}",
          "spanId": "{{ span_id }}",
          "parentSpanId": null,
          "kind": "SERVER",
          "resource": {
            "attributes": {
              "service.id": "{{ service_id }}",
              "service.name": "obsinity-reference-service",
              "service.version": "0.1.0",
              "deployment.environment": "dev"
            }
          },
          "attributes": {
            "api_name": "get_account_holders",
            "http.method": "GET",
            "http.status_code": 200
          },
          "events": [],
          "links": [],
          "status": { "code": "OK", "message": "" },
          "serviceId": "{{ service_id }}",
          "correlationId": "{{ correlation_id }}",
          "synthetic": false
        }
    headers:
      - name: Content-Type
        value: application/json
    settings:
      renderRequestBody: true
      encodeUrl: true
      followRedirects: global
      cookies: { send: true, store: true }
      rebuildPath: true

  - url: "{{ base_url }}/api/ingest/event"
    name: Ingest EventEnvelope (single, ERROR)
    meta:
      id: req_ingest_single_error
      created: 1754511487081
      modified: 1754511487081
      isPrivate: false
      description: "Send a single EventEnvelope with error status."
      sortKey: -95
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "eventId": "{{ event_id_error }}",
          "name": "api_request",
          "timestamp": "{{ nowIso }}",
          "endTimestamp": "{{ nowIso }}",
          "traceId": "{{ trace_id }}",
          "spanId": "{{ span_id_error }}",
          "parentSpanId": null,
          "kind": "SERVER",
          "resource": {
            "attributes": {
              "service.id": "{{ service_id }}",
              "service.name": "obsinity-reference-service",
              "service.version": "0.1.0",
              "deployment.environment": "dev"
            }
          },
          "attributes": {
            "api_name": "create_transaction",
            "http.method": "POST",
            "http.status_code": 500,
            "error.type": "java.lang.IllegalStateException"
          },
          "events": [],
          "links": [],
          "status": { "code": "ERROR", "message": "Simulated failure" },
          "serviceId": "{{ service_id }}",
          "correlationId": "{{ correlation_id }}",
          "synthetic": false
        }
    headers:
      - name: Content-Type
        value: application/json
    settings:
      renderRequestBody: true
      encodeUrl: true
      followRedirects: global
      cookies: { send: true, store: true }
      rebuildPath: true

  # ================ Ingest (batch) ================
  - url: "{{ base_url }}/api/ingest/events"
    name: Ingest EventEnvelope (batch)
    meta:
      id: req_ingest_batch
      created: 1754511487081
      modified: 1754511487081
      isPrivate: false
      description: "Send an array of EventEnvelope."
      sortKey: -90
    method: POST
    body:
      mimeType: application/json
      text: |
        [
          {
            "eventId": "{{ event_id_1 }}",
            "name": "api_request",
            "timestamp": "{{ nowIso }}",
            "endTimestamp": "{{ nowIso }}",
            "traceId": "{{ trace_id }}",
            "spanId": "{{ span_id }}",
            "kind": "CLIENT",
            "resource": { "attributes": { "service.id": "{{ service_id }}", "service.name": "obsinity-reference-client" } },
            "attributes": { "api_name": "lookup_user", "http.method": "GET", "http.status_code": 200 },
            "events": [],
            "links": [],
            "status": { "code": "OK" },
            "serviceId": "{{ service_id }}",
            "synthetic": false
          },
          {
            "eventId": "{{ event_id_2 }}",
            "name": "db_call",
            "timestamp": "{{ nowIso }}",
            "endTimestamp": "{{ nowIso }}",
            "traceId": "{{ trace_id }}",
            "spanId": "{{ span_id_2 }}",
            "kind": "INTERNAL",
            "resource": { "attributes": { "service.id": "{{ service_id }}", "service.name": "obsinity-reference-service" } },
            "attributes": { "db.system": "postgresql", "db.statement": "select 1" },
            "events": [],
            "links": [],
            "status": { "code": "OK" },
            "serviceId": "{{ service_id }}",
            "synthetic": false
          }
        ]
    headers:
      - name: Content-Type
        value: application/json
    settings:
      renderRequestBody: true
      encodeUrl: true
      followRedirects: global
      cookies: { send: true, store: true }
      rebuildPath: true

  # ================= Catalog =================
  - url: "{{ base_url }}/api/catalog/event-type"
    name: Catalog - List Event Types
    meta:
      id: req_catalog_list_types
      created: 1754511487082
      modified: 1754511487082
      isPrivate: false
      description: "GET list of registered event types."
      sortKey: -80
    method: GET
    body: { mimeType: application/json, text: "" }
    settings:
      renderRequestBody: true
      encodeUrl: true
      followRedirects: global
      cookies: { send: true, store: true }
      rebuildPath: true

  - url: "{{ base_url }}/api/catalog/event-type/{{ event_type }}"
    name: Catalog - Register/Upsert Event Type
    meta:
      id: req_catalog_register_type
      created: 1754511487083
      modified: 1754511487083
      isPrivate: false
      description: "POST to register or update an event type with its attributes."
      sortKey: -70
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "attributes": [
            "api_name",
            "http.method",
            "http.status_code"
          ]
        }
    headers:
      - name: Content-Type
        value: application/json
    settings:
      renderRequestBody: true
      encodeUrl: true
      followRedirects: global
      cookies: { send: true, store: true }
      rebuildPath: true

  - url: "{{ base_url }}/api/catalog/event-type/{{ event_type }}/index"
    name: Catalog - Add/Update Index
    meta:
      id: req_catalog_index
      created: 1754511487084
      modified: 1754511487084
      isPrivate: false
      description: "POST to create or update an index for an event type."
      sortKey: -60
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "index": [
            "api_name",
            "http.status_code"
          ]
        }
    headers:
      - name: Content-Type
        value: application/json
    settings:
      renderRequestBody: true
      encodeUrl: true
      followRedirects: global
      cookies: { send: true, store: true }
      rebuildPath: true

  # ================ Health (optional actuator) ================
  - url: "{{ base_url }}/actuator/health"
    name: Health
    meta:
      id: req_health
      created: 1754511487084
      modified: 1754511487084
      isPrivate: false
      description: "Spring Boot actuator health check (if enabled)."
      sortKey: -50
    method: GET
    body: { mimeType: application/json, text: "" }
    settings:
      renderRequestBody: true
      encodeUrl: true
      followRedirects: global
      cookies: { send: true, store: true }
      rebuildPath: true

cookieJar:
  name: Default Jar
  meta:
    id: jar_a149c3669a9047f3aef00b245c81d669
    created: 1753721379030
    modified: 1753721379030

environments:
  name: Base Environment
  meta:
    id: env_48ee75400dc54513958ace253d876e61
    created: 1753721379025
    modified: 1754639228167
    isPrivate: false
  data:
    base_url: http://localhost:8086
    service_id: obsinity-reference-service
    event_type: api_request
    nowIso: "{% now 'iso-8601', 'utc' %}"
    correlation_id: "{% uuid 'v4' %}"
    trace_id: "{% uuid 'v4' %}"
    span_id: "{% uuid 'v4' %}"
    span_id_2: "{% uuid 'v4' %}"
    span_id_error: "{% uuid 'v4' %}"
    event_id: "{% uuid 'v4' %}"
    event_id_1: "{% uuid 'v4' %}"
    event_id_2: "{% uuid 'v4' %}"
    event_id_error: "{% uuid 'v4' %}"
