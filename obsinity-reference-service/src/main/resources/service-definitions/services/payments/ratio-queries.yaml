service: payments
ratioQueries:
  - name: funnel_outcomes
    type: ratio
    source: transitions
    objectType: UserProfile
    attribute: user.status
    window:
      from: -15m
      to: now
    items:
      - transition: "NEW->ACTIVE"
        label: "Success"
      - transition: "NEW->ABANDONED"
        label: "Failed"
      - transition: "NEW->INACTIVE"
        label: "Expired"
    output:
      format: grafana_pie
      value: count
      includeRaw: true
      includePercent: true
      includeRatio: true
      decimals: 2
    behavior:
      zeroTotal: zeros
      missingItem: zero

  - name: state_distribution
    type: ratio
    source: states
    objectType: UserProfile
    attribute: user.status
    window:
      from: -1h
      to: now
    items:
      - state: "NEW"
      - state: "PENDING_EMAIL"
      - state: "PENDING_KYC"
      - state: "ACTIVE"
      - state: "ABANDONED"
      - state: "INACTIVE"
