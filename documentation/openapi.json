{
  "openapi": "3.0.3",
  "info": {
    "title": "Obsinity API (Manual Definition)",
    "version": "0.1.0",
    "description": "Manually curated OpenAPI definition for the Obsinity REST controllers.\nTelemetry events are ingested via OTEL-shaped envelopes, queried with OB-JQL,\nand enriched with HAL-compliant responses for pagination.\n"
  },
  "servers": [
    {
      "url": "https://api.example.com"
    }
  ],
  "paths": {
    "/events/publish": {
      "post": {
        "tags": [
          "Ingest"
        ],
        "summary": "Publish a single event",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EventEnvelope"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Event accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PublishResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/events/publish/batch": {
      "post": {
        "tags": [
          "Ingest"
        ],
        "summary": "Publish a batch of events",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/EventEnvelope"
                }
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Batch accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BatchPublishResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/search/events": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Search events (HAL)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "HAL search response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/objql/query": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Execute raw OBJQL query",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ObjqlQueryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Result rows",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/query/counters": {
      "post": {
        "tags": [
          "Counters"
        ],
        "summary": "Query counter intervals (HAL)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CounterQueryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Counter intervals (HAL)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CounterQueryResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/catalog/event-type": {
      "get": {
        "tags": [
          "Catalog"
        ],
        "summary": "List event types",
        "responses": {
          "200": {
            "description": "Event types",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/EventTypeSummary"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/catalog/event-type/{type}": {
      "post": {
        "tags": [
          "Catalog"
        ],
        "summary": "Ensure event type",
        "parameters": [
          {
            "$ref": "#/components/parameters/EventTypePath"
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EventTypeUpsertRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Upserted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleStatus"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "conflict": {
                    "$ref": "#/components/examples/ConflictError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/catalog/event-type/{type}/index": {
      "post": {
        "tags": [
          "Catalog"
        ],
        "summary": "Add index path to event type",
        "parameters": [
          {
            "$ref": "#/components/parameters/EventTypePath"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EventIndexRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Index accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleStatus"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "conflict": {
                    "$ref": "#/components/examples/ConflictError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/catalog/attributes/{service}/names": {
      "get": {
        "tags": [
          "Catalog"
        ],
        "summary": "List attribute names (HAL)",
        "parameters": [
          {
            "$ref": "#/components/parameters/ServicePath"
          },
          {
            "$ref": "#/components/parameters/Prefix"
          },
          {
            "$ref": "#/components/parameters/Offset"
          },
          {
            "$ref": "#/components/parameters/Limit"
          }
        ],
        "responses": {
          "200": {
            "description": "Attribute names",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AttributeNamesResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "notFound": {
                    "$ref": "#/components/examples/NotFoundError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/catalog/attributes/{service}/{attrName}/values": {
      "get": {
        "tags": [
          "Catalog"
        ],
        "summary": "List attribute values (HAL)",
        "parameters": [
          {
            "$ref": "#/components/parameters/ServicePath"
          },
          {
            "$ref": "#/components/parameters/AttributePath"
          },
          {
            "$ref": "#/components/parameters/Prefix"
          },
          {
            "$ref": "#/components/parameters/Offset"
          },
          {
            "$ref": "#/components/parameters/Limit"
          }
        ],
        "responses": {
          "200": {
            "description": "Attribute values",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AttributeValuesResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "notFound": {
                    "$ref": "#/components/examples/NotFoundError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "examples": {
      "BadRequestError": {
        "summary": "Bad Request",
        "value": {
          "timestamp": "2025-01-01T00:00:00Z",
          "status": 400,
          "error": "Bad Request",
          "message": "Invalid request payload",
          "path": "/api/request",
          "details": {
          }
        }
      },
      "NotFoundError": {
        "summary": "Not Found",
        "value": {
          "timestamp": "2025-01-01T00:00:00Z",
          "status": 404,
          "error": "Not Found",
          "message": "Resource not found",
          "path": "/api/request",
          "details": {
          }
        }
      },
      "ConflictError": {
        "summary": "Conflict",
        "value": {
          "timestamp": "2025-01-01T00:00:00Z",
          "status": 409,
          "error": "Conflict",
          "message": "Resource conflict",
          "path": "/api/request",
          "details": {
          }
        }
      },
      "InternalServerError": {
        "summary": "Internal Server Error",
        "value": {
          "timestamp": "2025-01-01T00:00:00Z",
          "status": 500,
          "error": "Internal Server Error",
          "message": "Unexpected error",
          "path": "/api/request",
          "details": {
          }
        }
      },
      "TransitionRatioMissingCounters": {
        "summary": "Missing transition counters",
        "value": {
          "timestamp": "2025-01-01T00:00:00Z",
          "status": 400,
          "error": "Bad Request",
          "message": "Missing transition counters for requested from/to pairs",
          "path": "/api/query/transition-ratios",
          "details": {
            "missingTransitions": [
              {
                "fromState": "NEW",
                "toState": "ARCHIVED"
              },
              {
                "fromState": "ACTIVE",
                "toState": "BLOCKED"
              }
            ]
          }
        }
      }
    },
    "parameters": {
      "ServicePath": {
        "name": "service",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        }
      },
      "AttributePath": {
        "name": "attrName",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        }
      },
      "EventTypePath": {
        "name": "type",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        }
      },
      "Prefix": {
        "name": "prefix",
        "in": "query",
        "required": false,
        "schema": {
          "type": "string"
        }
      },
      "Offset": {
        "name": "offset",
        "in": "query",
        "required": false,
        "schema": {
          "type": "integer",
          "minimum": 0,
          "default": 0
        }
      },
      "Limit": {
        "name": "limit",
        "in": "query",
        "required": false,
        "schema": {
          "type": "integer",
          "minimum": 1,
          "default": 50
        }
      }
    },
    "schemas": {
      "EventEnvelope": {
        "type": "object",
        "properties": {
          "event": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "kind": {
                "type": "string"
              }
            }
          },
          "resource": {
            "type": "object",
            "properties": {
              "service": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "trace": {
            "type": "object",
            "properties": {
              "correlationId": {
                "type": "string"
              },
              "traceId": {
                "type": "string"
              },
              "spanId": {
                "type": "string"
              },
              "parentSpanId": {
                "type": "string"
              }
            }
          },
          "time": {
            "type": "object",
            "properties": {
              "startedAt": {
                "type": "string",
                "format": "date-time"
              },
              "startUnixNano": {
                "type": "integer"
              },
              "endedAt": {
                "type": "string",
                "format": "date-time"
              },
              "endUnixNano": {
                "type": "integer"
              },
              "elapsedNanos": {
                "type": "integer"
              }
            }
          },
          "attributes": {
            "type": "object",
            "additionalProperties": true
          },
          "status": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            }
          },
          "events": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "links": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "synthetic": {
            "type": "boolean"
          },
          "return": {
            "nullable": true,
            "description": "Return value when intercepted method is non-void."
          }
        }
      },
      "PublishResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "eventId": {
            "type": "string"
          }
        },
        "required": [
          "status",
          "eventId"
        ]
      },
      "BatchPublishResponse": {
        "type": "object",
        "properties": {
          "stored": {
            "type": "integer"
          },
          "duplicates": {
            "type": "integer"
          }
        }
      },
      "SearchRequest": {
        "type": "object",
        "properties": {
          "service": {
            "type": "string"
          },
          "event": {
            "type": "string"
          },
          "period": {
            "type": "object",
            "properties": {
              "previous": {
                "type": "string"
              },
              "betweenTimestamps": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "matches": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "filter": {
            "type": "object"
          },
          "orders": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          }
        },
        "required": [
          "service",
          "period"
        ]
      },
      "SearchResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "embedded": {
            "type": "object",
            "properties": {
              "events": {
                "type": "array",
                "items": {
                  "type": "object"
                }
              }
            }
          },
          "links": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/HalLink"
            }
          }
        }
      },
      "HalLink": {
        "type": "object",
        "properties": {
          "href": {
            "type": "string"
          },
          "method": {
            "type": "string"
          },
          "body": {
            "type": "object"
          }
        }
      },
      "ObjqlQueryRequest": {
        "type": "object",
        "properties": {
          "q": {
            "type": "string"
          },
          "offset": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          }
        },
        "required": [
          "q"
        ]
      },
      "CounterQueryRequest": {
        "type": "object",
        "properties": {
          "serviceKey": {
            "type": "string"
          },
          "eventType": {
            "type": "string"
          },
          "counterName": {
            "type": "string"
          },
          "interval": {
            "type": "string"
          },
          "start": {
            "type": "string"
          },
          "end": {
            "type": "string"
          },
          "key": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "limits": {
            "type": "object",
            "properties": {
              "offset": {
                "type": "integer"
              },
              "limit": {
                "type": "integer"
              }
            }
          }
        },
        "required": [
          "serviceKey",
          "eventType",
          "counterName"
        ]
      },
      "CounterQueryResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "data": {
            "type": "object",
            "properties": {
              "intervals": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/CounterInterval"
                }
              }
            }
          },
          "links": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/HalLink"
            }
          }
        }
      },
      "CounterInterval": {
        "type": "object",
        "properties": {
          "from": {
            "type": "string"
          },
          "to": {
            "type": "string"
          },
          "counts": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CounterIntervalCount"
            }
          }
        }
      },
      "CounterIntervalCount": {
        "type": "object",
        "properties": {
          "key": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "count": {
            "type": "integer"
          }
        }
      },
      "EventTypeSummary": {
        "type": "object",
        "additionalProperties": true
      },
      "EventTypeUpsertRequest": {
        "type": "object",
        "properties": {
          "description": {
            "type": "string"
          }
        }
      },
      "EventIndexRequest": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string"
          }
        },
        "required": [
          "path"
        ]
      },
      "SimpleStatus": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          }
        }
      },
      "AttributeNamesResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "embedded": {
            "type": "object",
            "properties": {
              "attributes": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "attribute": {
                      "type": "string"
                    },
                    "valueCount": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          },
          "links": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/HalLink"
            }
          }
        }
      },
      "AttributeValuesResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "embedded": {
            "type": "object",
            "properties": {
              "values": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "attribute": {
                      "type": "string"
                    },
                    "seenCount": {
                      "type": "integer"
                    },
                    "firstSeen": {
                      "type": "string"
                    },
                    "lastSeen": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "links": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/HalLink"
            }
          }
        }
      }
    },
    "/api/query/state-counts": {
      "post": {
        "tags": [
          "State"
        ],
        "summary": "Query current state counts",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StateCountQueryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "State counts",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StateCountQueryResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/query/transition-ratios": {
      "post": {
        "tags": [
          "State"
        ],
        "summary": "Query resolved transition ratios",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TransitionRatioQueryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Transition ratios",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransitionRatioQueryResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "missingCounters": {
                    "$ref": "#/components/examples/TransitionRatioMissingCounters"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/query/state-count-timeseries": {
      "post": {
        "tags": [
          "State"
        ],
        "summary": "Query historical state count snapshots",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StateCountTimeseriesQueryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "State count time series",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StateCountTimeseriesQueryResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "badRequest": {
                    "$ref": "#/components/examples/BadRequestError"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorPayload"
                },
                "examples": {
                  "internalServerError": {
                    "$ref": "#/components/examples/InternalServerError"
                  }
                }
              }
            }
          }
        }
      },
      "StateCountQueryRequest": {
        "type": "object",
        "properties": {
          "serviceKey": {
            "type": "string"
          },
          "objectType": {
            "type": "string"
          },
          "attribute": {
            "type": "string"
          },
          "states": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "limits": {
            "$ref": "#/components/schemas/PageLimits"
          }
        },
        "required": [
          "serviceKey",
          "objectType",
          "attribute"
        ]
      },
      "StateCountQueryResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "data": {
            "type": "object",
            "properties": {
              "states": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "state": {
                      "type": "string"
                    },
                    "count": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          },
          "links": {
            "type": "object"
          }
        }
      },
      "StateCountTimeseriesQueryRequest": {
        "type": "object",
        "properties": {
          "serviceKey": {
            "type": "string"
          },
          "objectType": {
            "type": "string"
          },
          "attribute": {
            "type": "string"
          },
          "states": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "interval": {
            "type": "string"
          },
          "start": {
            "type": "string"
          },
          "end": {
            "type": "string"
          },
          "limits": {
            "$ref": "#/components/schemas/PageLimits"
          }
        },
        "required": [
          "serviceKey",
          "objectType",
          "attribute"
        ]
      },
      "TransitionRatioQueryRequest": {
        "type": "object",
        "properties": {
          "serviceKey": {
            "type": "string"
          },
          "objectType": {
            "type": "string"
          },
          "attribute": {
            "type": "string"
          },
          "transitions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "from": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "nullable": true
                  }
                },
                "to": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "required": [
                "from",
                "to"
              ]
            }
          },
          "interval": {
            "type": "string"
          },
          "start": {
            "type": "string"
          },
          "end": {
            "type": "string"
          },
          "groupByFromState": {
            "type": "boolean"
          }
        },
        "required": [
          "serviceKey",
          "objectType",
          "attribute",
          "transitions",
          "interval",
          "start",
          "end"
        ]
      },
      "TransitionRatioQueryResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer"
          },
          "totalCount": {
            "type": "integer"
          },
          "data": {
            "type": "object",
            "properties": {
              "transitions": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "fromState": {
                      "type": "string"
                    },
                    "toState": {
                      "type": "string"
                    },
                    "count": {
                      "type": "integer"
                    },
                    "ratio": {
                      "type": "number"
                    }
                  }
                }
              }
            }
          },
          "links": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/HalLink"
            }
          }
        }
      },
      "ErrorPayload": {
        "type": "object",
        "properties": {
          "timestamp": {
            "type": "string"
          },
          "status": {
            "type": "integer"
          },
          "error": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "path": {
            "type": "string"
          },
          "details": {
            "type": "object"
          }
        }
      },
      "StateCountTimeseriesQueryResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "data": {
            "type": "object",
            "properties": {
              "intervals": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "start": {
                      "type": "string"
                    },
                    "end": {
                      "type": "string"
                    },
                    "states": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "state": {
                            "type": "string"
                          },
                          "count": {
                            "type": "integer"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "links": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/HalLink"
            }
          }
        }
      }
    }
  }
}
